This is the code for version 1